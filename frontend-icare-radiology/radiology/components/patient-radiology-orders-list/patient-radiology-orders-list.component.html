<div class="w-100 mt-2">
  <div class="loading-overlay" *ngIf="saving">
    <div class="text-center">
      <div>Saving data...</div>
      <div class="mt-3 d-flex justify-content-center w-100">
        <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
      </div>
    </div>
  </div>
  <div>
    <div class="vertical-table">
      <div *ngFor="let order of formattedOrders; let count = index">
        <div class="vertical-table-row">
          <div class="vertical-table-cell">
            <strong>SN:</strong>
            {{ count + 1 }}
          </div>
          <div class="vertical-table-cell">
            <strong>Order ID:</strong>
            {{ order?.orderNumber }}
          </div>
          <div class="vertical-table-cell">
            <strong>Order:</strong>
            {{ order?.concept?.display }}
          </div>
          <div class="vertical-table-cell">
            <strong>Orderer:</strong>
            {{ order?.orderer?.display }}
          </div>
          <div class="vertical-table-cell">
            <strong>Instructions:</strong>
            {{ order?.instructions }}
          </div>
          <div class="vertical-table-cell">
            <strong>Status:</strong>
            {{
              order?.paid
                ? "Paid"
                : !order?.paid && order?.isAdmitted
                ? "Not paid but Admitted"
                : !order?.paid && order?.isEmergency
                ? "Not paid but has emergency"
                : "Not paid"
            }}
            <div class="vertical-table-cell">
              <strong>Upload:</strong>
              <div class="upload-container">
                <h2>UPLOAD IMAGE TO MONAI APPLICATION {{ order?.concept?.name }}</h2>
                <form (ngSubmit)="processImage($event, order)" enctype="multipart/form-data">
                  <div class="form-group">
                    <label for="file-selector-{{ order?.concept?.uuid }}">Upload here:</label>
                    <input 
                      type="file" 
                      id="file-selector-{{ order?.concept?.uuid }}" 
                      (change)="fileSelection($event, order)" 
                      accept="image/*"
                      required>
                  </div>
                  <div class="form-group">
                    <button type="submit" [disabled]="!values[order.uuid] || saving">Process Image</button>
                  </div>
                </form>
                <div *ngIf="imagePreviews[order.uuid]">
                  <strong>Original Image:</strong>
                  <img [src]="imagePreviews[order.uuid]" alt="Original Image Preview" class="img-preview" />
                </div>
                <div *ngIf="outputurl != null">
                  <strong>Processed Image:</strong>
                  <img [src]="outputurl" alt="Processed Image Preview" class="img-preview" />
                </div>
                <div *ngIf="saving">Processing...</div>                
                
              </div>
            </div>
          <div class="vertical-table-cell">
            <strong>Remarks:</strong>
            <mat-form-field class="w-100">
              <mat-label>Remarks</mat-label>
              <textarea
                matInput
                [value]="obsKeyedByConcepts[order?.concept?.uuid]?.comment"
                (keyup)="getRemarks($event, order)"
              ></textarea>
            </mat-form-field>
          </div>
          <div class="vertical-table-cell">
            <strong>Action:</strong>
            <div class="d-flex justify-content-between">
              <button
                [disabled]="!values[order?.uuid]"
                mat-stroked-button
                (click)="onSave($event, order)"
              >app-patient-radiology-orders-list
                Save
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>  